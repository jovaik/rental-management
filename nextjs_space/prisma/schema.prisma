// This is your Prisma schema file
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/rental_management/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

// Enums
enum BusinessType {
  SCOOTER_RENTAL
  VEHICLE_RENTAL
  PROPERTY_RENTAL
  BOAT_RENTAL
  EXPERIENCE_RENTAL
  EQUIPMENT_RENTAL
}

enum UserRole {
  SUPER_ADMIN
  OWNER
  ADMIN
  OPERATOR
  MECHANIC
}

enum ItemType {
  VEHICLE
  PROPERTY
  BOAT
  EXPERIENCE
  EQUIPMENT
}

enum ItemStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
  UNAVAILABLE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum InvoiceStatus {
  PENDING
  PAID
  CANCELLED
  REFUNDED
}

enum DocumentType {
  DNI
  NIE
  PASSPORT
  DRIVING_LICENSE
}

// Multi-tenant Models
model Tenant {
  id            String         @id @default(cuid())
  name          String
  subdomain     String         @unique
  businessTypes BusinessType[]
  location      String?
  logo          String?
  colors        Json?          // { primary: "#...", secondary: "#..." }
  config        Json?          // Additional configuration
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  // Relations
  users     User[]
  items     Item[]
  bookings  Booking[]
  customers Customer[]
  invoices  Invoice[]

  @@index([subdomain])
}

model User {
  id        String   @id @default(cuid())
  tenantId  String
  email     String   @unique
  name      String
  password  String
  role      UserRole
  avatar    String?
  phone     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([email])
}

model Item {
  id          String     @id @default(cuid())
  tenantId    String
  type        ItemType
  name        String
  description String?
  basePrice   Float
  status      ItemStatus @default(AVAILABLE)
  attributes  Json?      // Dynamic fields based on type
  photos      String[]   // Array of photo URLs
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relations
  tenant   Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@index([tenantId])
  @@index([type])
  @@index([status])
}

model Customer {
  id             String       @id @default(cuid())
  tenantId       String
  name           String
  email          String
  phone          String
  documentType   DocumentType
  documentNumber String
  documents      Json?        // Stored document URLs and metadata
  address        String?
  city           String?
  country        String?
  notes          String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  // Relations
  tenant   Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  bookings Booking[]

  @@unique([tenantId, email])
  @@index([tenantId])
  @@index([email])
  @@index([documentNumber])
}

model Booking {
  id         String        @id @default(cuid())
  tenantId   String
  itemId     String
  customerId String
  startDate  DateTime
  endDate    DateTime
  totalPrice Float
  deposit    Float         @default(0)
  status     BookingStatus @default(PENDING)
  notes      String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  // Relations
  tenant   Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  item     Item      @relation(fields: [itemId], references: [id], onDelete: Restrict)
  customer Customer  @relation(fields: [customerId], references: [id], onDelete: Restrict)
  invoices Invoice[]

  @@index([tenantId])
  @@index([itemId])
  @@index([customerId])
  @@index([startDate])
  @@index([endDate])
  @@index([status])
}

model Invoice {
  id            String        @id @default(cuid())
  tenantId      String
  bookingId     String
  invoiceNumber String
  amount        Float
  status        InvoiceStatus @default(PENDING)
  pdfUrl        String?
  dueDate       DateTime?
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  tenant  Tenant  @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  booking Booking @relation(fields: [bookingId], references: [id], onDelete: Restrict)

  @@index([tenantId])
  @@index([bookingId])
  @@index([invoiceNumber])
  @@index([status])
  @@unique([tenantId, invoiceNumber])
}
