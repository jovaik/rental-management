generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Booking {
  id         String        @id
  tenantId   String
  itemId     String
  customerId String
  startDate  DateTime
  endDate    DateTime
  totalPrice Float
  deposit    Float         @default(0)
  status     BookingStatus @default(PENDING)
  notes      String?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime
  Customer   Customer      @relation(fields: [customerId], references: [id])
  Item       Item          @relation(fields: [itemId], references: [id])
  Tenant     Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  Invoice    Invoice[]

  @@index([customerId])
  @@index([endDate])
  @@index([itemId])
  @@index([startDate])
  @@index([status])
  @@index([tenantId])
}

model Customer {
  id             String       @id
  tenantId       String
  name           String
  email          String
  phone          String
  documentType   DocumentType
  documentNumber String
  documents      Json?
  address        String?
  city           String?
  country        String?
  notes          String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime
  Booking        Booking[]
  Tenant         Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, email])
  @@index([documentNumber])
  @@index([email])
  @@index([tenantId])
}

model Invoice {
  id            String        @id
  tenantId      String
  bookingId     String
  invoiceNumber String
  amount        Float
  status        InvoiceStatus @default(PENDING)
  pdfUrl        String?
  dueDate       DateTime?
  paidAt        DateTime?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  Booking       Booking       @relation(fields: [bookingId], references: [id])
  Tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, invoiceNumber])
  @@index([bookingId])
  @@index([invoiceNumber])
  @@index([status])
  @@index([tenantId])
}

model Item {
  id          String     @id
  tenantId    String
  type        ItemType
  name        String
  description String?
  basePrice   Float
  status      ItemStatus @default(AVAILABLE)
  attributes  Json?
  photos      String[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  Booking     Booking[]
  Tenant      Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([tenantId])
  @@index([type])
}

model Tenant {
  id            String         @id
  name          String
  subdomain     String         @unique
  businessTypes BusinessType[]
  location      String?
  logo          String?
  colors        Json?
  config        Json?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime
  Booking       Booking[]
  Customer      Customer[]
  Invoice       Invoice[]
  Item          Item[]
  User          User[]

  @@index([subdomain])
}

model User {
  id        String   @id
  tenantId  String
  email     String   @unique
  name      String
  password  String
  role      UserRole
  avatar    String?
  phone     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime
  Tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([tenantId])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum BusinessType {
  SCOOTER_RENTAL
  VEHICLE_RENTAL
  PROPERTY_RENTAL
  BOAT_RENTAL
  EXPERIENCE_RENTAL
  EQUIPMENT_RENTAL
}

enum DocumentType {
  DNI
  NIE
  PASSPORT
  DRIVING_LICENSE
}

enum InvoiceStatus {
  PENDING
  PAID
  CANCELLED
  REFUNDED
}

enum ItemStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
  UNAVAILABLE
}

enum ItemType {
  VEHICLE
  PROPERTY
  BOAT
  EXPERIENCE
  EQUIPMENT
}

enum UserRole {
  SUPER_ADMIN
  OWNER
  ADMIN
  OPERATOR
  MECHANIC
}
